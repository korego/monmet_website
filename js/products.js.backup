// Products data organized by manufacturer
const productsData = {
  cfm: {
    title: "CFM",
    description:
      "Quality fireplace fan kits and blowers compatible with CFM and Vermont Castings fireplaces.",
    products: [
      {
        code: "MFK-24",
        name: "Fan Kit MFK-24",
        image: "img/products_catalog/product_2.jpg",
        oem: "CFM / Vermont Castings",
        dimensions: '2.5" x 9.5" (65mm x 240mm)',
        cfm: "140",
      },
      {
        code: "MFK-12",
        name: "Fan Kit MFK-12",
        image: "img/products_catalog/product_3.jpg",
        oem: "CFM / Vermont Castings",
        dimensions: '2.5" x 9.5" (65mm x 240mm)',
        cfm: "140",
      },
      {
        code: "BLWR-VC-MAJ",
        name: "Blower BLWR-VC-MAJ",
        image: "img/products_catalog/product_5.jpg",
        oem: "CFM / Vermont Castings",
        dimensions: '2.5" x 9.5" (65mm x 240mm)',
        cfm: "140",
      },
    ],
  },
  continental: {
    title: "Continental",
    description:
      "Replacement fan kits and blowers for Continental and Napoleon fireplace models.",
    products: [
      {
        code: "MFK-550",
        name: "Fan Kit MFK-550",
        image: "img/products_catalog/product_7.jpg",
        oem: "Napoleon (GZ550)",
        dimensions: '2.25" x 7" (60mm x 180mm)',
        cfm: "115",
      },
      {
        code: "MFK-62-1",
        name: "Fan Kit MFK-62-1",
        image: "img/products_catalog/product_8.jpg",
        oem: "Napoleon (NZ-62)",
        dimensions: '2.25" x 7" (60mm x 180mm)',
        cfm: "115",
      },
      {
        code: "MFK-62",
        name: "Fan Kit MFK-62",
        image: "img/products_catalog/product_10.jpg",
        oem: "Napoleon (EP-62)",
        dimensions: '2.25" x 7" (60mm x 180mm)',
        cfm: "115",
      },
    ],
  },
  empire: {
    title: "Empire",
    description:
      "High-performance fan kits and blowers for Empire Comfort Systems fireplaces.",
    products: [
      {
        code: "MFK-FBB4",
        name: "Fan Kit MFK-FBB4",
        image: "img/products_catalog/MFK-FBB4-2017w.jpg",
        oem: "Empire Comfort Systems (FBB4)",
        dimensions: '2.25" x 9.5" (60mm x 240mm)',
        cfm: "120",
      },
      {
        code: "BLWR-FBB4",
        name: "Blower BLWR-FBB4",
        image: "img/products_catalog/BLWR-BLOT-2017w.jpg",
        oem: "Empire Comfort Systems",
        dimensions: '2.25" x 9.5" (60mm x 240mm)',
        cfm: "120",
      },
    ],
  },
  "heat-glo": {
    title: "Heat & Glo",
    description: "Premium fan kits designed for Heat & Glo fireplace systems.",
    products: [
      {
        code: "MFK-4B",
        name: "Fan Kit MFK-4B",
        image: "img/products_catalog/MFK-4B-2017w.jpg",
        oem: "Heat & Glo",
        dimensions: '2.25" x 9.5" (60mm x 240mm)',
        cfm: "120",
      },
      {
        code: "MFK-46",
        name: "Fan Kit MFK-46",
        image: "img/products_catalog/MFK-46-2017w.jpg",
        oem: "Heat & Glo",
        dimensions: '2.25" x 9.5" (60mm x 240mm)',
        cfm: "120",
      },
    ],
  },
  heatilator: {
    title: "Heatilator",
    description:
      "Reliable replacement fans and blowers for Heatilator fireplace models.",
    products: [
      {
        code: "MFK-21",
        name: "Fan Kit MFK-21",
        image: "img/products_catalog/MFK-21-w.jpg",
        oem: "Heatilator",
        dimensions: '2.25" x 9.5" (60mm x 240mm)',
        cfm: "120",
      },
      {
        code: "MFK-BLOT240",
        name: "Fan Kit MFK-BLOT240",
        image: "img/products_catalog/MFK-BLOT240-2017w.jpg",
        oem: "Heatilator",
        dimensions: '2.25" x 9.5" (60mm x 240mm)',
        cfm: "120",
      },
    ],
  },
  "ihp-lennox": {
    title: "IHP / Lennox",
    description:
      "Compatible fan kits for IHP and Lennox fireplace installations.",
    products: [
      {
        code: "MFK-100S",
        name: "Fan Kit MFK-100S",
        image: "img/products_catalog/MFK-100S-w.jpg",
        oem: "IHP / Lennox",
        dimensions: '2.25" x 9.5" (60mm x 240mm)',
        cfm: "120",
      },
      {
        code: "MFK-200S",
        name: "Fan Kit MFK-200S",
        image: "img/products_catalog/MFK-200S.jpg",
        oem: "IHP / Lennox",
        dimensions: '2.25" x 9.5" (60mm x 240mm)',
        cfm: "120",
      },
      {
        code: "MFK-250S",
        name: "Fan Kit MFK-250S",
        image: "img/products_catalog/MFK-250S-w.jpg",
        oem: "IHP / Lennox",
        dimensions: '2.25" x 9.5" (60mm x 240mm)',
        cfm: "120",
      },
    ],
  },
  kingsman: {
    title: "Kingsman",
    description: "Efficient fan systems for Kingsman fireplace models.",
    products: [
      {
        code: "BLWR-KNGMN46",
        name: "Blower BLWR-KNGMN46",
        image: "img/products_catalog/BLWR-KNGMN46-2017w.jpg",
        oem: "Kingsman",
        dimensions: '2.25" x 9.5" (60mm x 240mm)',
        cfm: "120",
      },
    ],
  },
  "kozy-heat": {
    title: "Kozy Heat",
    description: "Quality replacement blowers for Kozy Heat fireplace systems.",
    products: [
      {
        code: "MFK-AUB",
        name: "Fan Kit MFK-AUB",
        image: "img/products_catalog/MFK-AUB-w.jpg",
        oem: "Kozy Heat",
        dimensions: '2.25" x 9.5" (60mm x 240mm)',
        cfm: "120",
      },
      {
        code: "BLWR-AUB",
        name: "Blower BLWR-AUB",
        image: "img/products_catalog/BLWR-AUB-w.jpg",
        oem: "Kozy Heat",
        dimensions: '2.25" x 9.5" (60mm x 240mm)',
        cfm: "120",
      },
      {
        code: "MFK-AUB-M",
        name: "Fan Kit MFK-AUB-M",
        image: "img/products_catalog/MFK-AUB-M-2017w.jpg",
        oem: "Kozy Heat",
        dimensions: '2.25" x 9.5" (60mm x 240mm)',
        cfm: "120",
      },
    ],
  },
  majestic: {
    title: "Majestic",
    description:
      "Durable fan kits designed for Majestic fireplace applications.",
    products: [
      {
        code: "MFK-SLA42",
        name: "Fan Kit MFK-SLA42",
        image: "img/products_catalog/MFK-SLA42-2017w.jpg",
        oem: "Majestic",
        dimensions: '2.25" x 9.5" (60mm x 240mm)',
        cfm: "120",
      },
      {
        code: "BLWR-SLA42",
        name: "Blower BLWR-SLA42",
        image: "img/products_catalog/BLWR-SLA42-2017w.jpg",
        oem: "Majestic",
        dimensions: '2.25" x 9.5" (60mm x 240mm)',
        cfm: "120",
      },
    ],
  },
  monessen: {
    title: "Monessen",
    description: "Replacement fan solutions for Monessen fireplace models.",
    products: [
      {
        code: "MFK-BLOTST-SC",
        name: "Fan Kit MFK-BLOTST-SC",
        image: "img/products_catalog/MFK-BLOTST-SC-w.jpg",
        oem: "Monessen",
        dimensions: '2.25" x 9.5" (60mm x 240mm)',
        cfm: "120",
      },
    ],
  },
  napoleon: {
    title: "Napoleon",
    description:
      "High-quality fan kits and blowers for Napoleon fireplace systems.",
    products: [
      {
        code: "EP-36",
        name: "Fan Kit EP-36",
        image: "img/products_catalog/EP-36-w.jpg",
        oem: "Napoleon",
        dimensions: '2.25" x 7" (60mm x 180mm)',
        cfm: "115",
      },
    ],
  },
  "pacific-energy": {
    title: "Pacific Energy",
    description:
      "Efficient fan systems for Pacific Energy wood and gas fireplaces.",
    products: [
      {
        code: "MFK-PE",
        name: "Fan Kit MFK-PE",
        image: "img/products_catalog/product_photo1.png",
        oem: "Pacific Energy",
        dimensions: "Various sizes",
        cfm: "Varies by model",
      },
    ],
  },
  travis: {
    title: "Travis",
    description:
      "Replacement blowers for Travis Industries fireplace products.",
    products: [
      {
        code: "MFK-TRAVIS",
        name: "Fan Kit for Travis",
        image: "img/products_catalog/product_12.jpg",
        oem: "Travis Industries",
        dimensions: '2.25" x 9.5" (60mm x 240mm)',
        cfm: "120",
      },
    ],
  },
  universal: {
    title: "Universal",
    description:
      "Versatile fan kits compatible with multiple fireplace brands.",
    products: [
      {
        code: "MFK-UNIVDBL",
        name: "Universal Double Blower Kit",
        image: "img/products_catalog/MFK-UNIVDBL-w.jpg",
        oem: "Universal Fit",
        dimensions: "Adjustable",
        cfm: "140",
      },
      {
        code: "UNIV-SPDCTRL",
        name: "Universal Speed Control",
        image: "img/products_catalog/UNIV-SPDCTRL-2017w.jpg",
        oem: "Universal",
        dimensions: "N/A",
        cfm: "N/A",
      },
    ],
  },
  "vermont-castings": {
    title: "Vermont Castings",
    description: "Premium fan kits for Vermont Castings wood and gas stoves.",
    products: [
      {
        code: "MFK-VC",
        name: "Fan Kit for Vermont Castings",
        image: "img/products_catalog/product_13.jpg",
        oem: "Vermont Castings",
        dimensions: '2.5" x 9.5" (65mm x 240mm)',
        cfm: "140",
      },
    ],
  },
  "wolf-steel": {
    title: "Wolf Steel",
    description: "Reliable fan solutions for Wolf Steel fireplace products.",
    products: [
      {
        code: "MFK-WS",
        name: "Fan Kit for Wolf Steel",
        image: "img/products_catalog/product_14.jpg",
        oem: "Wolf Steel",
        dimensions: '2.25" x 9.5" (60mm x 240mm)',
        cfm: "120",
      },
    ],
  },
  accessories: {
    title: "Accessories",
    description:
      "Speed controls, mounting brackets, and other fireplace blower accessories.",
    products: [
      {
        code: "SPD-CTRLBRKT",
        name: "Speed Control Bracket",
        image: "img/products_catalog/SPD-CTRLBRKT-2017w.jpg",
        oem: "Universal",
        dimensions: "Standard mounting",
        cfm: "N/A",
      },
    ],
  },
};

// Initialize products page
document.addEventListener("DOMContentLoaded", function () {
  const manufacturerLinks = document.querySelectorAll(".manufacturer-link");
  const productsContainer = document.getElementById("products-container");
  const sidebarToggle = document.getElementById("sidebarToggle");
  const sidebar = document.querySelector(".products-sidebar");
  const productsMain = document.querySelector(".products-main");

  // Load all manufacturers as sections
  loadAllManufacturers();

  // Scroll spy functionality
  let scrollTimeout;
  const sections = [];

  // Build sections array after loading manufacturers
  setTimeout(() => {
    Object.keys(productsData).forEach((key) => {
      const section = document.getElementById(key);
      if (section) {
        sections.push({
          id: key,
          element: section,
          link: document.querySelector(`[data-manufacturer="${key}"]`),
        });
      }
    });

    // Initialize scroll spy
    initScrollSpy();
  }, 100);

  function initScrollSpy() {
    productsMain.addEventListener("scroll", () => {
      clearTimeout(scrollTimeout);
      scrollTimeout = setTimeout(updateActiveLink, 50);
    });

    // Initial check
    updateActiveLink();
  }

  function updateActiveLink() {
    const scrollPos = productsMain.scrollTop + 150; // Offset for header

    let currentSection = sections[0];

    for (const section of sections) {
      const rect = section.element.getBoundingClientRect();
      const sectionTop =
        rect.top + productsMain.scrollTop - productsMain.offsetTop;

      if (scrollPos >= sectionTop) {
        currentSection = section;
      }
    }

    // Update active states
    manufacturerLinks.forEach((link) => link.classList.remove("active"));
    if (currentSection && currentSection.link) {
      currentSection.link.classList.add("active");
    }
  }

  // Manufacturer navigation click handlers - smooth scroll to section
  manufacturerLinks.forEach((link) => {
    link.addEventListener("click", function (e) {
      e.preventDefault();

      const manufacturer = this.getAttribute("data-manufacturer");
      const targetSection = document.getElementById(manufacturer);

      if (targetSection) {
        // Smooth scroll to section
        const offsetTop =
          targetSection.offsetTop - productsMain.offsetTop - 100;
        productsMain.scrollTo({
          top: offsetTop,
          behavior: "smooth",
        });

        // Update URL hash
        history.pushState(null, null, `#${manufacturer}`);

        // Close sidebar on mobile
        if (window.innerWidth <= 768) {
          sidebar.classList.remove("active");
        }
      }
    });
  });

  // Mobile sidebar toggle
  if (sidebarToggle) {
    sidebarToggle.addEventListener("click", function () {
      sidebar.classList.toggle("active");
    });
  }

  // Load all manufacturers as scrollable sections
  function loadAllManufacturers() {
    productsContainer.innerHTML = "";

    Object.keys(productsData).forEach((manufacturer, index) => {
      const section = createManufacturerSection(manufacturer, index);
      productsContainer.appendChild(section);
    });
  }

  function createManufacturerSection(manufacturer, index) {
    const data = productsData[manufacturer];
    const section = document.createElement("section");
    section.id = manufacturer;
    section.className = "manufacturer-section";
    section.style.opacity = "0";
    section.style.transform = "translateY(20px)";

    const header = document.createElement("div");
    header.className = "section-header-products";
    header.innerHTML = `
      <h2>${data.title}</h2>
      <p>${data.description}</p>
    `;

    const grid = document.createElement("div");
    grid.className = "products-grid-section";

    data.products.forEach((product) => {
      const productCard = createProductCard(product);
      grid.appendChild(productCard);
    });

    section.appendChild(header);
    section.appendChild(grid);

    // Stagger animation
    setTimeout(() => {
      section.style.opacity = "1";
      section.style.transform = "translateY(0)";
      section.style.transition = "all 0.6s ease";
    }, index * 100);

    return section;
  }

  // Create product card element
  function createProductCard(product) {
    const card = document.createElement("div");
    card.className = "product-card";
    card.style.opacity = "0";
    card.style.transform = "translateY(20px)";
    card.style.transition = "all 0.3s ease";

    card.innerHTML = `
            <div class="product-image">
                <img src="${product.image}" alt="${product.name}" onerror="this.src='img/products/fireplacekit_product.png'">
            </div>
            <div class="product-info">
                <h3>${product.name}</h3>
                <div class="product-code">${product.code}</div>
                <div class="product-specs">
                    <div class="spec">
                        <i class="fas fa-industry"></i>
                        <span><strong>OEM:</strong> ${product.oem}</span>
                    </div>
                    <div class="spec">
                        <i class="fas fa-ruler-combined"></i>
                        <span><strong>Size:</strong> ${product.dimensions}</span>
                    </div>
                    <div class="spec">
                        <i class="fas fa-wind"></i>
                        <span><strong>CFM:</strong> ${product.cfm}</span>
                    </div>
                </div>
                <a href="index.html#contact" class="btn-quote">Request Quote</a>
            </div>
        `;

    return card;
  }

  // Handle hash changes for direct links
  window.addEventListener("hashchange", function () {
    const hash = window.location.hash.substring(1);
    if (hash && productsData[hash]) {
      const link = document.querySelector(`[data-manufacturer="${hash}"]`);
      if (link) {
        link.click();
      }
    }
  });

  // Load from hash on page load
  const initialHash = window.location.hash.substring(1);
  if (initialHash && productsData[initialHash]) {
    const link = document.querySelector(`[data-manufacturer="${initialHash}"]`);
    if (link) {
      link.click();
    }
  }
});
